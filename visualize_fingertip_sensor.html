<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  />
  <title>Fingertip Pressure Sensor Visualizer (SVG Hand)</title>
  <style>
    :root {
      --accent: #000; /* Í∞ïÏ°∞ ÏÉâÏÉÅÏùÄ Í≤ÄÏ†ï */
    }
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #ffffff 0%, #e6e6e6 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      color: #000;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }
    h1 {
      margin-bottom: 18px;
    }

    /* Î°úÍ≥† */
    .logo {
      width: 220px;
      margin: 140px auto 20px;
      display: block;
    }

    /* ====== SVG Hand frame ====== */
    .hand-frame {
      position: relative;
      margin: 160px auto 18px;
      width: 100%;
      max-width: 1000px;
      aspect-ratio: 5/4;
      border-radius: 24px;
      overflow: visible;
    }
    .hand-svg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    .hand-shape {
      fill: #f2f2f2;
      stroke: #ccc;
      stroke-width: 2;
    }
    .hand-detail {
      fill: none;
      stroke: #ddd;
      stroke-width: 2;
      stroke-linecap: round;
    }

    /* ====== Finger sections (cards) positioned on the SVG ====== */
    .finger-section {
      position: absolute;
      width: clamp(200px, 18vw, 160px);
      background: #fff;
      border-radius: 18px;
      padding: 14px;
      border: 1px solid #ddd;
      text-align: center;
      color: #000;
    }
    .finger-title {
      margin: 0 0 10px 0;
      font-size: 16px;
      color: #000;
      font-weight: bold;
    }
    .finger-sensors {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 0 auto;
    }
    .pressure-sensor {
      background: #f9f9f9;
      border-radius: 12px;
      padding: 10px;
      text-align: center;
      border: 2px solid #ddd;
      transition: all .25s ease;
    }
    .pressure-sensor:hover { transform: translateY(-3px); box-shadow: 0 6px 14px rgba(0,0,0,.2); }
    .sensor-number {
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 4px;
      color: #333;
    }
    .pressure-value {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 6px;
    }
    .pressure-bar {
      width: 100%;
      height: 8px;
      background: #eee;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }
    .pressure-fill {
      height: 100%;
      background: linear-gradient(90deg, #000, #444, #777);
      transition: width .25s ease;
      border-radius: 4px;
      width: 0%;
    }

    /* ====== Absolute positions per finger ====== */
    #thumbSection  { left: -30%;  top: 120%; }
    #indexSection  { left: 0%; top: 5%;  }
    #middleSection { left: 30%; top: 0%;  }
    #ringSection   { left: 60%; top: 5%;  }
    #pinkySection  { left: 90%; top: 15%; }

    .palm-badge {
      position: absolute;
      left: 50%;
      top: 56%;
      translate: 0 -50%;
      background: #fff;
      border: 1px solid #ccc;
      padding: 12px 18px;
      border-radius: 999px;
      color: #000;
      font-weight: 700;
      letter-spacing: .5px;
      pointer-events: none;
    }

    .data-info {
      background: #fafafa;
      padding: 14px;
      border-radius: 10px;
      margin: 16px auto 0;
      font-size: 14px;
      max-width: 800px;
      border: 1px solid #ddd;
    }
    .timestamp { color: #000; font-weight: bold; }

    @media (max-width: 840px) {
      .finger-section { width: clamp(190px, 40vw, 240px); }
      #thumbSection  { left: 4%; top: 62%; }
      #indexSection  { left: 20%; top: 8%; }
      #middleSection { left: 42%; top: 5%; }
      #ringSection   { left: 63%; top: 9%; }
      #pinkySection  { left: 78%; top: 18%; }
      .palm-badge    { left: 34%; top: 58%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Î°úÍ≥† -->
    <img src="https://www.robotis.com/data/editor/2408/e4ecce3eeb712a2f6cf99ef3857609fc_1724035678_8.png" alt="ROBOTIS Logo" class="logo" />

    <!-- ===== SVG HAND + positioned sections ===== -->
    <div class="hand-frame">

        <!-- Positioned finger sections -->
        <div class="finger-section" id="thumbSection">
          <h3 class="finger-title">üñêÔ∏è Thumb (finger_sensor_1)</h3>
          <div class="finger-sensors">
            <div class="pressure-sensor" id="sensor1"><div class="sensor-number">1</div><div class="pressure-value" id="value1">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar1"></div></div></div>
            <div class="pressure-sensor" id="sensor2"><div class="sensor-number">2</div><div class="pressure-value" id="value2">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar2"></div></div></div>
            <div class="pressure-sensor" id="sensor3"><div class="sensor-number">3</div><div class="pressure-value" id="value3">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar3"></div></div></div>
            <div class="pressure-sensor" id="sensor4"><div class="sensor-number">4</div><div class="pressure-value" id="value4">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar4"></div></div></div>
            <div class="pressure-sensor" id="sensor5"><div class="sensor-number">5</div><div class="pressure-value" id="value5">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar5"></div></div></div>
            <div class="pressure-sensor" id="sensor6"><div class="sensor-number">6</div><div class="pressure-value" id="value6">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar6"></div></div></div>
            <div class="pressure-sensor" id="sensor7"><div class="sensor-number">7</div><div class="pressure-value" id="value7">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar7"></div></div></div>
            <div class="pressure-sensor" id="sensor8"><div class="sensor-number">8</div><div class="pressure-value" id="value8">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar8"></div></div></div>
            <div class="pressure-sensor" id="sensor9"><div class="sensor-number">9</div><div class="pressure-value" id="value9">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar9"></div></div></div>
          </div>
        </div>

        <div class="finger-section" id="indexSection">
          <h3 class="finger-title">üëÜ Index (finger_sensor_2)</h3>
          <div class="finger-sensors">
            <div class="pressure-sensor" id="sensor10"><div class="sensor-number">1</div><div class="pressure-value" id="value10">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar10"></div></div></div>
            <div class="pressure-sensor" id="sensor11"><div class="sensor-number">2</div><div class="pressure-value" id="value11">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar11"></div></div></div>
            <div class="pressure-sensor" id="sensor12"><div class="sensor-number">3</div><div class="pressure-value" id="value12">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar12"></div></div></div>
            <div class="pressure-sensor" id="sensor13"><div class="sensor-number">4</div><div class="pressure-value" id="value13">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar13"></div></div></div>
            <div class="pressure-sensor" id="sensor14"><div class="sensor-number">5</div><div class="pressure-value" id="value14">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar14"></div></div></div>
            <div class="pressure-sensor" id="sensor15"><div class="sensor-number">6</div><div class="pressure-value" id="value15">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar15"></div></div></div>
            <div class="pressure-sensor" id="sensor16"><div class="sensor-number">7</div><div class="pressure-value" id="value16">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar16"></div></div></div>
            <div class="pressure-sensor" id="sensor17"><div class="sensor-number">8</div><div class="pressure-value" id="value17">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar17"></div></div></div>
            <div class="pressure-sensor" id="sensor18"><div class="sensor-number">9</div><div class="pressure-value" id="value18">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar18"></div></div></div>
          </div>
        </div>

        <div class="finger-section" id="middleSection">
          <h3 class="finger-title">üñï Middle (finger_sensor_3)</h3>
          <div class="finger-sensors">
            <div class="pressure-sensor" id="sensor19"><div class="sensor-number">1</div><div class="pressure-value" id="value19">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar19"></div></div></div>
            <div class="pressure-sensor" id="sensor20"><div class="sensor-number">2</div><div class="pressure-value" id="value20">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar20"></div></div></div>
            <div class="pressure-sensor" id="sensor21"><div class="sensor-number">3</div><div class="pressure-value" id="value21">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar21"></div></div></div>
            <div class="pressure-sensor" id="sensor22"><div class="sensor-number">4</div><div class="pressure-value" id="value22">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar22"></div></div></div>
            <div class="pressure-sensor" id="sensor23"><div class="sensor-number">5</div><div class="pressure-value" id="value23">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar23"></div></div></div>
            <div class="pressure-sensor" id="sensor24"><div class="sensor-number">6</div><div class="pressure-value" id="value24">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar24"></div></div></div>
            <div class="pressure-sensor" id="sensor25"><div class="sensor-number">7</div><div class="pressure-value" id="value25">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar25"></div></div></div>
            <div class="pressure-sensor" id="sensor26"><div class="sensor-number">8</div><div class="pressure-value" id="value26">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar26"></div></div></div>
            <div class="pressure-sensor" id="sensor27"><div class="sensor-number">9</div><div class="pressure-value" id="value27">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar27"></div></div></div>
          </div>
        </div>

        <div class="finger-section" id="ringSection">
          <h3 class="finger-title">üíç Ring (finger_sensor_4)</h3>
          <div class="finger-sensors">
            <div class="pressure-sensor" id="sensor28"><div class="sensor-number">1</div><div class="pressure-value" id="value28">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar28"></div></div></div>
            <div class="pressure-sensor" id="sensor29"><div class="sensor-number">2</div><div class="pressure-value" id="value29">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar29"></div></div></div>
            <div class="pressure-sensor" id="sensor30"><div class="sensor-number">3</div><div class="pressure-value" id="value30">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar30"></div></div></div>
            <div class="pressure-sensor" id="sensor31"><div class="sensor-number">4</div><div class="pressure-value" id="value31">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar31"></div></div></div>
            <div class="pressure-sensor" id="sensor32"><div class="sensor-number">5</div><div class="pressure-value" id="value32">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar32"></div></div></div>
            <div class="pressure-sensor" id="sensor33"><div class="sensor-number">6</div><div class="pressure-value" id="value33">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar33"></div></div></div>
            <div class="pressure-sensor" id="sensor34"><div class="sensor-number">7</div><div class="pressure-value" id="value34">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar34"></div></div></div>
            <div class="pressure-sensor" id="sensor35"><div class="sensor-number">8</div><div class="pressure-value" id="value35">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar35"></div></div></div>
            <div class="pressure-sensor" id="sensor36"><div class="sensor-number">9</div><div class="pressure-value" id="value36">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar36"></div></div></div>
          </div>
        </div>

        <div class="finger-section" id="pinkySection">
          <h3 class="finger-title">ü§è Pinky (finger_sensor_5)</h3>
          <div class="finger-sensors">
            <div class="pressure-sensor" id="sensor37"><div class="sensor-number">1</div><div class="pressure-value" id="value37">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar37"></div></div></div>
            <div class="pressure-sensor" id="sensor38"><div class="sensor-number">2</div><div class="pressure-value" id="value38">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar38"></div></div></div>
            <div class="pressure-sensor" id="sensor39"><div class="sensor-number">3</div><div class="pressure-value" id="value39">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar39"></div></div></div>
            <div class="pressure-sensor" id="sensor40"><div class="sensor-number">4</div><div class="pressure-value" id="value40">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar40"></div></div></div>
            <div class="pressure-sensor" id="sensor41"><div class="sensor-number">5</div><div class="pressure-value" id="value41">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar41"></div></div></div>
            <div class="pressure-sensor" id="sensor42"><div class="sensor-number">6</div><div class="pressure-value" id="value42">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar42"></div></div></div>
            <div class="pressure-sensor" id="sensor43"><div class="sensor-number">7</div><div class="pressure-value" id="value43">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar43"></div></div></div>
            <div class="pressure-sensor" id="sensor44"><div class="sensor-number">8</div><div class="pressure-value" id="value44">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar44"></div></div></div>
            <div class="pressure-sensor" id="sensor45"><div class="sensor-number">9</div><div class="pressure-value" id="value45">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar45"></div></div></div>
          </div>
        </div>

      </div>

    </div>

    <script>
      let ros = null;
      let topic = null;

      function connect() {
        if (typeof ROSLIB === 'undefined') {
          console.error('ROSLIB is not loaded');
          return;
        }
        try {
          ros = new ROSLIB.Ros({ url: 'ws://127.0.0.1:40153' });
          ros.on('connection', function () {
            console.log('Connected to ROS Bridge');
            subscribeToTopic();
          });
          ros.on('error', function (error) {
            console.error('ROS connection error:', error);
          });
          ros.on('close', function () {
            console.log('Disconnected from ROS Bridge');
          });
        } catch (err) {
          console.error('Failed to create ROS connection:', err);
        }
      }

      function subscribeToTopic() {
        if (!ros) return;
        topic = new ROSLIB.Topic({
          ros: ros,
          name: '/dynamic_joint_states',
          messageType: 'control_msgs/DynamicJointState'
        });
        topic.subscribe(function (message) {
          processMessage(message);
        });
      }

      function processMessage(message) {
        try {
          const pressureValues = new Array(45).fill(0);
          const prefix = 'finger_r_sensor';
          const sensorJointNames = [
            `${prefix}1`,
            `${prefix}2`,
            `${prefix}3`,
            `${prefix}4`,
            `${prefix}5`
          ];

          for (let fingerIndex = 0; fingerIndex < sensorJointNames.length; fingerIndex++) {
            const jointName = sensorJointNames[fingerIndex];
            const jointIndex = message.joint_names.indexOf(jointName);
            if (jointIndex === -1) continue;
            const iface = message.interface_values[jointIndex];
            if (iface && iface.interface_names && iface.values) {
              for (let j = 0; j < iface.interface_names.length; j++) {
                const name = iface.interface_names[j];
                if (name.startsWith('Present Pressure ')) {
                  const n = parseInt(name.split(' ')[2], 10);
                  if (n >= 1 && n <= 9) {
                    const globalIdx = fingerIndex * 9 + (n - 1);
                    pressureValues[globalIdx] = iface.values[j] || 0;
                  }
                }
              }
            }
          }
          updatePressureDisplay(pressureValues);
          updateTimestamp();
        } catch (e) {
          console.error('Error processing message:', e);
        }
      }

      function updatePressureDisplay(vals) {
        for (let i = 1; i <= 45; i++) {
          const value = vals[i - 1] ?? 0;
          const vEl = document.getElementById(`value${i}`);
          const bEl = document.getElementById(`bar${i}`);
          const sEl = document.getElementById(`sensor${i}`);
          if (vEl && bEl && sEl) {
            vEl.textContent = Math.round(value);
            const pct = Math.min((value / 255) * 100, 100);
            bEl.style.width = pct + '%';
            // border color by intensity
            if (value < 85) sEl.style.borderColor = '#4CAF50';
            else if (value < 170) sEl.style.borderColor = '#FF9800';
            else sEl.style.borderColor = '#F44336';
          }
        }
      }

      function updateTimestamp() {
        const now = new Date();
        document.getElementById('lastUpdate').textContent = now.toLocaleTimeString();
      }

      // Load ROSLIB from CDN(s) and auto-connect
      (function loadROSLib() {
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/roslib@1.3.0/build/roslib.min.js';
        script.onload = () => {
          console.log('ROSLIB loaded, connecting...');
          connect();
        };
        script.onerror = () => {
          const alt = document.createElement('script');
          alt.src = 'https://unpkg.com/roslib@1.3.0/build/roslib.min.js';
          alt.onload = () => {
            console.log('ROSLIB loaded from alt source, connecting...');
            connect();
          };
          alt.onerror = () => {
            console.error('ROSLIB.js Load Failed - Check network');
          };
          document.head.appendChild(alt);
        };
        document.head.appendChild(script);
      })();
    </script>
</body>
</html>
