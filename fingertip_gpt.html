<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  />
  <title>Fingertip Pressure Sensor Visualizer (SVG Hand)</title>
  <style>
    :root {
      --accent: #ffd700;
    }
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      color: white;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      text-align: center;
    }
    h1 {
      margin-bottom: 18px;
      text-shadow: 2px 2px 4px rgba(0,0,0,.3);
    }
    .connection-controls {
      margin-bottom: 14px;
    }
    button {
      background: rgba(255,255,255,0.2);
      border: 2px solid rgba(255,255,255,0.3);
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      margin: 0 8px;
      transition: all .3s ease;
      backdrop-filter: blur(10px);
    }
    button:hover { background: rgba(255,255,255,0.3); transform: translateY(-2px); }
    button:disabled { opacity:.5; cursor:not-allowed; transform:none; }

    .status {
      background: rgba(255,255,255,0.1);
      padding: 12px 16px;
      border-radius: 10px;
      margin: 10px auto 18px;
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255,255,255,0.18);
      max-width: 600px;
    }
    .status.connected {
      background: rgba(76,175,80,0.18);
      border-color: #4caf50;
    }
    .status.disconnected {
      background: rgba(244,67,54,0.18);
      border-color: #f44336;
    }

    /* ====== SVG Hand frame ====== */
    .hand-frame {
      position: relative;
      margin: 50px auto 18px;
      width: 100%;
      max-width: 1500px;
      /* Ïú†ÏßÄÎêòÎäî Ï¢ÖÌö°ÎπÑ: ÏÜê Î™®Ïñë Î≥¥Í∏∞ Ï¢ãÍ≤å 5:4 */
      aspect-ratio: 5/4;
      border-radius: 24px;
      overflow: visible;
    }
    .hand-svg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      filter: drop-shadow(0 6px 16px rgba(0,0,0,.35));
    }
    .hand-shape {
      fill: rgba(255,255,255,0.08);
      stroke: rgba(255,255,255,0.18);
      stroke-width: 2;
      backdrop-filter: blur(6px);
    }
    .hand-detail {
      fill: none;
      stroke: rgba(255,255,255,0.12);
      stroke-width: 2;
      stroke-linecap: round;
    }

    /* ====== Finger sections (cards) positioned on the SVG ====== */
    .finger-section {
      position: absolute;
      width: clamp(210px, 22vw, 260px);
      background: rgba(255,255,255,0.05);
      border-radius: 18px;
      padding: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(10px);
      text-align: center;
    }
    .finger-title {
      margin: 0 0 10px 0;
      font-size: 16px;
      color: var(--accent);
      text-shadow: 1px 1px 2px rgba(0,0,0,.25);
    }
    .finger-sensors {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 0 auto;
    }
    .pressure-sensor {
      background: rgba(255,255,255,.10);
      border-radius: 12px;
      padding: 10px;
      text-align: center;
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255,255,255,.2);
      transition: all .25s ease;
      position: relative;
      overflow: hidden;
    }
    .pressure-sensor:hover { transform: translateY(-3px); box-shadow: 0 8px 18px rgba(0,0,0,.28); }
    .sensor-number {
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 4px;
      color: var(--accent);
    }
    .pressure-value {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 6px;
    }
    .pressure-bar {
      width: 100%;
      height: 8px;
      background: rgba(255,255,255,0.2);
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }
    .pressure-fill {
      height: 100%;
      background: linear-gradient(90deg, #4caf50, #8bc34a, #ffeb3b, #ff9800, #f44336);
      transition: width .25s ease;
      border-radius: 4px;
      width: 0%;
    }

    /* ====== Absolute positions per finger (percentages of frame) ======
       Ï¢åÌëúÎäî hand-frame(ÏÉÅÎåÄ) Í∏∞Ï§ÄÏúºÎ°ú Î∞òÏùëÌòï Î∞∞ÏπòÎê® */
    #thumbSection  { left: -20%;  top: 130%; }
    #indexSection  { left: 0%; top: 5%;  }
    #middleSection { left: 30%; top: 0%;  }
    #ringSection   { left: 60%; top: 5%;  }
    #pinkySection  { left: 90%; top: 15%; }

    /* Í∞ÄÏö¥Îç∞ ÏÜêÎ∞îÎã• ÎùºÎ≤®(ÏòµÏÖò) */
    .palm-badge {
      position: absolute;
      left: 50%;
      top: 56%;
      translate: 0 -50%;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      padding: 12px 18px;
      border-radius: 999px;
      color: var(--accent);
      font-weight: 700;
      letter-spacing: .5px;
      text-shadow: 1px 1px 2px rgba(0,0,0,.25);
      pointer-events: none;
    }

    .data-info {
      background: rgba(255,255,255,0.1);
      padding: 14px;
      border-radius: 10px;
      margin: 16px auto 0;
      backdrop-filter: blur(10px);
      font-size: 14px;
      max-width: 800px;
      border: 1px solid rgba(255,255,255,0.14);
    }
    .timestamp { color: var(--accent); font-weight: bold; }

    /* Î™®Î∞îÏùº ÏÇ¥Ïßù Î≥¥Ï†ï */
    @media (max-width: 840px) {
      .finger-section { width: clamp(190px, 40vw, 240px); }
      #thumbSection  { left: 4%; top: 62%; }
      #indexSection  { left: 20%; top: 8%; }
      #middleSection { left: 42%; top: 5%; }
      #ringSection   { left: 63%; top: 9%; }
      #pinkySection  { left: 78%; top: 18%; }
      .palm-badge    { left: 34%; top: 58%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- <h1>ü§ñ Fingertip Pressure Sensor Visualizer</h1> -->

    <div class="connection-controls">
      <button id="connectBtn" onclick="connect()">Connect to ROS Bridge</button>
      <button id="disconnectBtn" onclick="disconnect()" disabled>Disconnect</button>
    </div>

    <div id="status" class="status disconnected">
      <strong>Status:</strong> <span id="statusText">Disconnected</span>
    </div>

    <!-- ===== SVG HAND + positioned sections ===== -->
    <div class="hand-frame">

      <!-- Positioned finger sections -->
      <div class="finger-section" id="thumbSection">
        <h3 class="finger-title">üñêÔ∏è Thumb (finger_sensor_1)</h3>
        <div class="finger-sensors">
          <div class="pressure-sensor" id="sensor1"><div class="sensor-number">1</div><div class="pressure-value" id="value1">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar1"></div></div></div>
          <div class="pressure-sensor" id="sensor2"><div class="sensor-number">2</div><div class="pressure-value" id="value2">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar2"></div></div></div>
          <div class="pressure-sensor" id="sensor3"><div class="sensor-number">3</div><div class="pressure-value" id="value3">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar3"></div></div></div>
          <div class="pressure-sensor" id="sensor4"><div class="sensor-number">4</div><div class="pressure-value" id="value4">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar4"></div></div></div>
          <div class="pressure-sensor" id="sensor5"><div class="sensor-number">5</div><div class="pressure-value" id="value5">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar5"></div></div></div>
          <div class="pressure-sensor" id="sensor6"><div class="sensor-number">6</div><div class="pressure-value" id="value6">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar6"></div></div></div>
          <div class="pressure-sensor" id="sensor7"><div class="sensor-number">7</div><div class="pressure-value" id="value7">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar7"></div></div></div>
          <div class="pressure-sensor" id="sensor8"><div class="sensor-number">8</div><div class="pressure-value" id="value8">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar8"></div></div></div>
          <div class="pressure-sensor" id="sensor9"><div class="sensor-number">9</div><div class="pressure-value" id="value9">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar9"></div></div></div>
        </div>
      </div>

      <div class="finger-section" id="indexSection">
        <h3 class="finger-title">üëÜ Index (finger_sensor_2)</h3>
        <div class="finger-sensors">
          <div class="pressure-sensor" id="sensor10"><div class="sensor-number">1</div><div class="pressure-value" id="value10">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar10"></div></div></div>
          <div class="pressure-sensor" id="sensor11"><div class="sensor-number">2</div><div class="pressure-value" id="value11">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar11"></div></div></div>
          <div class="pressure-sensor" id="sensor12"><div class="sensor-number">3</div><div class="pressure-value" id="value12">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar12"></div></div></div>
          <div class="pressure-sensor" id="sensor13"><div class="sensor-number">4</div><div class="pressure-value" id="value13">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar13"></div></div></div>
          <div class="pressure-sensor" id="sensor14"><div class="sensor-number">5</div><div class="pressure-value" id="value14">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar14"></div></div></div>
          <div class="pressure-sensor" id="sensor15"><div class="sensor-number">6</div><div class="pressure-value" id="value15">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar15"></div></div></div>
          <div class="pressure-sensor" id="sensor16"><div class="sensor-number">7</div><div class="pressure-value" id="value16">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar16"></div></div></div>
          <div class="pressure-sensor" id="sensor17"><div class="sensor-number">8</div><div class="pressure-value" id="value17">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar17"></div></div></div>
          <div class="pressure-sensor" id="sensor18"><div class="sensor-number">9</div><div class="pressure-value" id="value18">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar18"></div></div></div>
        </div>
      </div>

      <div class="finger-section" id="middleSection">
        <h3 class="finger-title">üñï Middle (finger_sensor_3)</h3>
        <div class="finger-sensors">
          <div class="pressure-sensor" id="sensor19"><div class="sensor-number">1</div><div class="pressure-value" id="value19">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar19"></div></div></div>
          <div class="pressure-sensor" id="sensor20"><div class="sensor-number">2</div><div class="pressure-value" id="value20">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar20"></div></div></div>
          <div class="pressure-sensor" id="sensor21"><div class="sensor-number">3</div><div class="pressure-value" id="value21">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar21"></div></div></div>
          <div class="pressure-sensor" id="sensor22"><div class="sensor-number">4</div><div class="pressure-value" id="value22">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar22"></div></div></div>
          <div class="pressure-sensor" id="sensor23"><div class="sensor-number">5</div><div class="pressure-value" id="value23">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar23"></div></div></div>
          <div class="pressure-sensor" id="sensor24"><div class="sensor-number">6</div><div class="pressure-value" id="value24">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar24"></div></div></div>
          <div class="pressure-sensor" id="sensor25"><div class="sensor-number">7</div><div class="pressure-value" id="value25">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar25"></div></div></div>
          <div class="pressure-sensor" id="sensor26"><div class="sensor-number">8</div><div class="pressure-value" id="value26">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar26"></div></div></div>
          <div class="pressure-sensor" id="sensor27"><div class="sensor-number">9</div><div class="pressure-value" id="value27">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar27"></div></div></div>
        </div>
      </div>

      <div class="finger-section" id="ringSection">
        <h3 class="finger-title">üíç Ring (finger_sensor_4)</h3>
        <div class="finger-sensors">
          <div class="pressure-sensor" id="sensor28"><div class="sensor-number">1</div><div class="pressure-value" id="value28">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar28"></div></div></div>
          <div class="pressure-sensor" id="sensor29"><div class="sensor-number">2</div><div class="pressure-value" id="value29">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar29"></div></div></div>
          <div class="pressure-sensor" id="sensor30"><div class="sensor-number">3</div><div class="pressure-value" id="value30">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar30"></div></div></div>
          <div class="pressure-sensor" id="sensor31"><div class="sensor-number">4</div><div class="pressure-value" id="value31">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar31"></div></div></div>
          <div class="pressure-sensor" id="sensor32"><div class="sensor-number">5</div><div class="pressure-value" id="value32">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar32"></div></div></div>
          <div class="pressure-sensor" id="sensor33"><div class="sensor-number">6</div><div class="pressure-value" id="value33">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar33"></div></div></div>
          <div class="pressure-sensor" id="sensor34"><div class="sensor-number">7</div><div class="pressure-value" id="value34">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar34"></div></div></div>
          <div class="pressure-sensor" id="sensor35"><div class="sensor-number">8</div><div class="pressure-value" id="value35">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar35"></div></div></div>
          <div class="pressure-sensor" id="sensor36"><div class="sensor-number">9</div><div class="pressure-value" id="value36">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar36"></div></div></div>
        </div>
      </div>

      <div class="finger-section" id="pinkySection">
        <h3 class="finger-title">ü§è Pinky (finger_sensor_5)</h3>
        <div class="finger-sensors">
          <div class="pressure-sensor" id="sensor37"><div class="sensor-number">1</div><div class="pressure-value" id="value37">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar37"></div></div></div>
          <div class="pressure-sensor" id="sensor38"><div class="sensor-number">2</div><div class="pressure-value" id="value38">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar38"></div></div></div>
          <div class="pressure-sensor" id="sensor39"><div class="sensor-number">3</div><div class="pressure-value" id="value39">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar39"></div></div></div>
          <div class="pressure-sensor" id="sensor40"><div class="sensor-number">4</div><div class="pressure-value" id="value40">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar40"></div></div></div>
          <div class="pressure-sensor" id="sensor41"><div class="sensor-number">5</div><div class="pressure-value" id="value41">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar41"></div></div></div>
          <div class="pressure-sensor" id="sensor42"><div class="sensor-number">6</div><div class="pressure-value" id="value42">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar42"></div></div></div>
          <div class="pressure-sensor" id="sensor43"><div class="sensor-number">7</div><div class="pressure-value" id="value43">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar43"></div></div></div>
          <div class="pressure-sensor" id="sensor44"><div class="sensor-number">8</div><div class="pressure-value" id="value44">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar44"></div></div></div>
          <div class="pressure-sensor" id="sensor45"><div class="sensor-number">9</div><div class="pressure-value" id="value45">0</div><div class="pressure-bar"><div class="pressure-fill" id="bar45"></div></div></div>
        </div>
      </div>

    </div>

  </div>

  <script>
    let ros = null;
    let topic = null;

    function connect() {
      if (typeof ROSLIB === 'undefined') {
        console.error('ROSLIB is not loaded');
        updateStatus('ROSLIB.js Not Loaded - Please refresh page', false);
        return;
      }
      try {
        ros = new ROSLIB.Ros({ url: 'ws://127.0.0.1:9090' });
        ros.on('connection', function () {
          updateStatus('Connected', true);
          document.getElementById('connectBtn').disabled = true;
          document.getElementById('disconnectBtn').disabled = false;
          subscribeToTopic();
        });
        ros.on('error', function (error) {
          console.error('ROS connection error:', error);
          updateStatus('Connection Error', false);
        });
        ros.on('close', function () {
          updateStatus('Disconnected', false);
          document.getElementById('connectBtn').disabled = false;
          document.getElementById('disconnectBtn').disabled = true;
        });
      } catch (err) {
        console.error('Failed to create ROS connection:', err);
        updateStatus('Connection Failed', false);
      }
    }

    function disconnect() {
      if (topic) { topic.unsubscribe(); topic = null; }
      if (ros) { ros.close(); ros = null; }
    }

    function subscribeToTopic() {
      if (!ros) return;
      topic = new ROSLIB.Topic({
        ros: ros,
        name: '/dynamic_joint_states',
        messageType: 'control_msgs/DynamicJointState'
      });
      topic.subscribe(function (message) {
        processMessage(message);
      });
    }

    function processMessage(message) {
      try {
        const pressureValues = new Array(45).fill(0);
        const fingerSensorIndices = [];
        for (let i = 0; i < message.joint_names.length; i++) {
          if (message.joint_names[i].startsWith('finger_sensor_')) {
            fingerSensorIndices.push(i);
          }
        }
        // Sort to ensure finger order: 1..5
        fingerSensorIndices.sort((a, b) => {
          const fa = parseInt(message.joint_names[a].split('_').pop(), 10);
          const fb = parseInt(message.joint_names[b].split('_').pop(), 10);
          return fa - fb;
        });

        for (let fingerIndex = 0; fingerIndex < fingerSensorIndices.length; fingerIndex++) {
          const jointIndex = fingerSensorIndices[fingerIndex];
          const iface = message.interface_values[jointIndex];
          if (iface && iface.interface_names && iface.values) {
            for (let j = 0; j < iface.interface_names.length; j++) {
              const name = iface.interface_names[j];
              if (name.startsWith('Present Pressure ')) {
                const n = parseInt(name.split(' ')[2], 10);
                if (n >= 1 && n <= 9) {
                  const globalIdx = fingerIndex * 9 + (n - 1);
                  pressureValues[globalIdx] = iface.values[j] || 0;
                }
              }
            }
          }
        }
        updatePressureDisplay(pressureValues);
        updateTimestamp();
      } catch (e) {
        console.error('Error processing message:', e);
      }
    }

    function updatePressureDisplay(vals) {
      for (let i = 1; i <= 45; i++) {
        const value = vals[i - 1] ?? 0;
        const vEl = document.getElementById(`value${i}`);
        const bEl = document.getElementById(`bar${i}`);
        const sEl = document.getElementById(`sensor${i}`);
        if (vEl && bEl && sEl) {
          vEl.textContent = Math.round(value);
          const pct = Math.min((value / 255) * 100, 100);
          bEl.style.width = pct + '%';
          // border color by intensity
          if (value < 85) sEl.style.borderColor = '#4CAF50';
          else if (value < 170) sEl.style.borderColor = '#FF9800';
          else sEl.style.borderColor = '#F44336';
        }
      }
    }

    function updateTimestamp() {
      const now = new Date();
      document.getElementById('lastUpdate').textContent = now.toLocaleTimeString();
    }

    function updateStatus(text, ok) {
      const box = document.getElementById('status');
      document.getElementById('statusText').textContent = text;
      box.className = 'status ' + (ok ? 'connected' : 'disconnected');
    }

    // Load ROSLIB from CDN(s)
    (function loadROSLib() {
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/roslib@1.3.0/build/roslib.min.js';
      script.onload = () => { document.getElementById('connectBtn').disabled = false; };
      script.onerror = () => {
        const alt = document.createElement('script');
        alt.src = 'https://unpkg.com/roslib@1.3.0/build/roslib.min.js';
        alt.onload = () => { document.getElementById('connectBtn').disabled = false; };
        alt.onerror = () => {
          updateStatus('ROSLIB.js Load Failed - Check network', false);
          document.getElementById('connectBtn').disabled = true;
        };
        document.head.appendChild(alt);
      };
      document.head.appendChild(script);
    })();
  </script>
</body>
</html>
